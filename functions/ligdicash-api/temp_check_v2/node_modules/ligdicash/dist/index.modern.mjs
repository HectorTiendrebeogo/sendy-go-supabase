import t from"cross-fetch";function e(){return e=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(t[r]=s[r])}return t},e.apply(this,arguments)}const s={test:"https://test.ligdicash.com/pay/v01/",live:"https://app.ligdicash.com/pay/v01/"};class r extends Error{constructor(t,e){super(e),this.code=void 0,this.code=t,this.name=e}}class i extends r{constructor(t){super(t,"[AuthenticationError]: api_key ou auth_token invalide")}}class a extends r{constructor(t){super(t,"[ApplicationAuthenticationError]: Impossible d'authentifier votre application")}}class o extends r{constructor(t){super(t,"[RecipientOperatorNotIdentified]: L'opérateur du destinataire n'a pas été identifié")}}class n extends r{constructor(t){super(t,"[MerchantBalanceLowError]: Solde Marchand insuffisant")}}class c extends r{constructor(t){super(t,"[MerchantPayoutDisabledError]: Payout désactivé pour ce marchand")}}class u extends r{constructor(t){super(t,"[MerchantPayinDisabledError]: Payin non activé pour ce marchand")}}class l extends r{constructor(t){super(t,"[CustomerDoesNotExistError]: Client non enregistré sur la plateforme")}}class h extends r{constructor(t){super(t,"[TransactionAlreadyExistError]: La transaction existe déjà")}}class p extends r{constructor(t){super(t,"[UnauthorizedCurrencyConversionError]: Conversion de devise non autorisée")}}class d extends r{constructor(t){super(t,"[InvoiceNotFoundError]: Facture introuvable")}}class m extends r{constructor(t){super(t,"[InvalidAmountError]: Montant invalide. Il doit être compris entre 20 et 1 000 000.")}}class _ extends r{constructor(t){super(t,"[MerchantAccountDoesNotExistError]: Aucun compte marchand sur le réseau spécifié")}}class y extends r{constructor(t){super(t,"[NoPendProcPayout24HError]: Aucun paiement en attente ou traité au cours des dernières 24 heures")}}class v extends r{constructor(t){super(t,"[NoDeposit3MError]: Aucun paiement en attente ou traité au cours des 3 derniers mois")}}class f extends r{constructor(t){super(t,"Le montant demandé est en dehors de l'intervalle [20;1000000].")}}class x extends r{constructor(t){super(t,"[IpDeniedError]: Adresse IP refusée.")}}class b extends r{constructor(t){super(t,"[ProcessingError]: Une erreur s'est produite pendant le traitement.")}}class w extends r{constructor(t){super(t,"[SendingError]: Une erreur s'est produite pendant l'envoi.")}}class E extends r{constructor(t){super(t,"[DataInputError]: Données incorrectes.")}}class k extends r{constructor(t){super(t,"[ApiError]: Erreur d'API.")}}class g extends r{constructor(t){super(t,"[NoHashError]: Aucun hash fourni.")}}class T extends r{constructor(t){super(t,"[InvalidHashError]: Hash invalide.")}}const A={test:{"00":i,"01":a,"02":f,"03":_,"04":y,"05":o,"06":_,"07":_,"08":n,"09":b,10:k,11:g,12:T,13:p,14:x},live:{"00":i,"01":a,"02":f,"03":_,"04":y,"05":o,"06":_,"07":_,"08":n,"09":b,10:k,11:g,12:T,13:p,14:x}},U={test:{"00":i,"01":c,"02":l,"03":_,"03a":y,"03b":v,"04":n,"05":f,"06":x,"07":h,"08":b,"09":E,10:k,13:g,14:T},live:{"00":i,"01":c,"02":l,"03":_,"03a":y,"03b":v,"04":n,"05":f,"06":x,"07":h,"08":b,"09":E,10:k,13:g,14:T}},I={payin:{test:{"00":i,"01":a,"02":m,"03":x,"04":b},live:{"00":i,"01":u,"02":m,"03":x,"04":b,"05":w,"06":w,"07":class extends r{constructor(t){super(t,"[NoNetworkAccessConfigurationError]: Aucun accès réseau configuré.")}},"08":E,"09":k,10:g,11:T,12:class extends r{constructor(t){super(t,"[InvalidMethodError]: Methode invalide.")}},13:class extends r{constructor(t){super(t,"[UnauthorizedMethodError]: Methode non autorisée.")}}}},client_payout:U,merchant_payout:A,status:{test:{"00":i,"01":a,"02":d,"03":b},live:{"00":i,"01":u,"02":d,"03":b,"04":E}}};class P{constructor(t){this.apiKey=void 0,this.authToken=void 0,this.baseUrl=void 0,this.platform=void 0,this.apiKey=t.apiKey,this.authToken=t.authToken,this.platform=t.platform||"test",this.baseUrl=t.baseUrl||s[t.platform]}buildUrl(t){return this.baseUrl+t}async request(s,r){const i=this.buildUrl(s),a=e({},r,{headers:{Apikey:this.apiKey,Authorization:"Bearer "+this.authToken,Accept:"application/json","Content-Type":"application/json"}});let o=await t(i,a);if(o.ok)return o.json();throw new Error(o.statusText)}}class q extends P{async getDataOrRaiseError(t,e){const s=t,r=t.response_text;if("00"==t.response_code){let e=t.custom_data;if(e&&e.length>0){let t=e.reduce((t,e)=>(t[e.keyof_customdata]=e.valueof_customdata,t),{});s.custom_data=t}return s}{let t=r.match(/\d{2,3}[a-z]?/i);const s=t?t[0]:"",i=function(t,e,s){var r,i;return(null==I||null==(r=I[e])||null==(i=r[t])?void 0:i[s])||k}(this.platform,e,s);throw new i(s)}}async get(t,e){var s=await this.request(t);return await this.getDataOrRaiseError(s,e)}async post(t,e,s){var r=await this.request(t,{method:"POST",body:JSON.stringify(e)});return await this.getDataOrRaiseError(r,s)}}class K{constructor(t){this.name=void 0,this.description="",this._unit_price=void 0,this._quantity=void 0,this._total_price=void 0,this.name=t.name,this.description=(null==t?void 0:t.description)||"",this.quantity=t.quantity,this.unit_price=t.unit_price,this._total_price=t.unit_price*t.quantity}get quantity(){return this._quantity}set quantity(t){this._quantity=t,this._total_price=this.unit_price*t}get unit_price(){return this._unit_price}set unit_price(t){this._unit_price=t,this._total_price=this._quantity*t}get total_price(){return this._total_price}format(){return{name:this.name,description:this.description,quantity:this.quantity,unit_price:this.unit_price,total_price:this.total_price}}}class D extends q{constructor(t,e){super(t),this._items=void 0,this.currency="xof",this.description="",this.customer_firstname="",this.customer_lastname="",this.customer_email="",this.store_name="",this.store_website_url="",this.external_id="",this.otp="",this._total_amount=0,this.currency=(null==e?void 0:e.currency)||"XOF",this.description=(null==e?void 0:e.description)||"",this.customer_firstname=(null==e?void 0:e.customer_firstname)||"",this.customer_lastname=(null==e?void 0:e.customer_lastname)||"",this.customer_email=(null==e?void 0:e.customer_email)||"",this.store_name=(null==e?void 0:e.store_name)||"",this.store_website_url=(null==e?void 0:e.store_website_url)||"",this._items=[]}get items(){return this._items}get total_amount(){return this._total_amount}setItemsTotalAmount(){this._total_amount=this._items.reduce((t,e)=>t+e.total_price,0)}addItem(t){this._items.push(new K(t)),this.setItemsTotalAmount()}formatInvoice(t=""){return{items:this._items.map(t=>t.format()),total_amount:this._total_amount,devise:this.currency,description:this.description,customer:t||"",customer_firstname:this.customer_firstname,customer_lastname:this.customer_lastname,customer_email:this.customer_email,external_id:this.external_id,otp:this.otp}}formatPayload(t="",e=null,s=null,r="",i={}){let a={callback_url:r};return e&&(a.cancel_url=e),s&&(a.return_url=s),{commande:{invoice:this.formatInvoice(t),store:{name:this.store_name,website_url:this.store_website_url},actions:a,custom_data:i}}}async payWithRedirection({cancel_url:t="",return_url:e="",callback_url:s="",custom_data:r={}}){let i=this.formatPayload(null,t,e,s,r);return await this.post("redirect/checkout-invoice/create",i,"payin")}async payWithoutRedirection({otp:t="",customer:e="",callback_url:s="",custom_data:r={}}){this.otp=t;let i=this.formatPayload(e,s,null,null,r);return await this.post("straight/checkout-invoice/create",i,"payin")}}class M extends q{constructor(t,e,s,r){super(t),this.amount=0,this.description="",this.customer="",this.amount=e,this.description=s,this.customer=r}async send(t){let e={amount:this.amount,description:this.description,customer:this.customer,custom_data:t.custom_data||{},callback_url:t.callback_url||""};"client"===t.type&&(e.to_ligdicash=t.to_wallet||!1);let s={commande:e};return await this.post("client"===t.type?"withdrawal/create":"straight/payout",s,"client"===t.type?"client_payout":"merchant_payout")}}class O{constructor(t){this.apiKey=void 0,this.authToken=void 0,this.baseUrl=void 0,this.platform=void 0,this.apiKey=t.apiKey,this.authToken=t.authToken,this.platform=t.platform||"test",this.baseUrl=t.baseUrl}Withdrawal(t,e,s){return new M({apiKey:this.apiKey,authToken:this.authToken,platform:this.platform,baseUrl:this.baseUrl},t,e,s)}Invoice(t){return new D({apiKey:this.apiKey,authToken:this.authToken,platform:this.platform,baseUrl:this.baseUrl},t)}getTransaction(t,e="payin"){return async function(t,e,s="payin"){const r=new q(t);return await r.get("payin"===s?`redirect/checkout-invoice/confirm/?invoiceToken=${e}`:"client_payout"===s?`withdrawal/confirm/?withdrawalToken=${e}`:`straight/payout/confirm/?payoutToken=${e}`,"status")}({apiKey:this.apiKey,authToken:this.authToken,platform:this.platform,baseUrl:this.baseUrl},t,e)}}export{O as default};
//# sourceMappingURL=index.modern.mjs.map
