import t from"cross-fetch";function r(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,"symbol"==typeof(i=function(t,r){if("object"!=typeof t||null===t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key))?i:String(i),n)}var i}function e(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function n(){return n=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var e=arguments[r];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t},n.apply(this,arguments)}function i(t,r){t.prototype=Object.create(r.prototype),t.prototype.constructor=t,u(t,r)}function o(t){return o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},o(t)}function u(t,r){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},u(t,r)}function a(t,r,e){return a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct.bind():function(t,r,e){var n=[null];n.push.apply(n,r);var i=new(Function.bind.apply(t,n));return e&&u(i,e.prototype),i},a.apply(null,arguments)}function c(t){var r="function"==typeof Map?new Map:void 0;return c=function(t){if(null===t||-1===Function.toString.call(t).indexOf("[native code]"))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(t))return r.get(t);r.set(t,e)}function e(){return a(t,arguments,o(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),u(e,t)},c(t)}var s={test:"https://test.ligdicash.com/pay/v01/",live:"https://app.ligdicash.com/pay/v01/"},l=/*#__PURE__*/function(t){function r(r,e){var n;return(n=t.call(this,e)||this).code=void 0,n.code=r,n.name=e,n}return i(r,t),r}(/*#__PURE__*/c(Error)),h=/*#__PURE__*/function(t){function r(r){return t.call(this,r,"[AuthenticationError]: api_key ou auth_token invalide")||this}return i(r,t),r}(l),f=/*#__PURE__*/function(t){function r(r){return t.call(this,r,"[ApplicationAuthenticationError]: Impossible d'authentifier votre application")||this}return i(r,t),r}(l),p=/*#__PURE__*/function(t){function r(r){return t.call(this,r,"[RecipientOperatorNotIdentified]: L'opérateur du destinataire n'a pas été identifié")||this}return i(r,t),r}(l),d=/*#__PURE__*/function(t){function r(r){return t.call(this,r,"[MerchantBalanceLowError]: Solde Marchand insuffisant")||this}return i(r,t),r}(l),m=/*#__PURE__*/function(t){function r(r){return t.call(this,r,"[MerchantPayoutDisabledError]: Payout désactivé pour ce marchand")||this}return i(r,t),r}(l),v=/*#__PURE__*/function(t){function r(r){return t.call(this,r,"[MerchantPayinDisabledError]: Payin non activé pour ce marchand")||this}return i(r,t),r}(l),y=/*#__PURE__*/function(t){function r(r){return t.call(this,r,"[CustomerDoesNotExistError]: Client non enregistré sur la plateforme")||this}return i(r,t),r}(l),_=/*#__PURE__*/function(t){function r(r){return t.call(this,r,"[TransactionAlreadyExistError]: La transaction existe déjà")||this}return i(r,t),r}(l),b=/*#__PURE__*/function(t){function r(r){return t.call(this,r,"[UnauthorizedCurrencyConversionError]: Conversion de devise non autorisée")||this}return i(r,t),r}(l),P=/*#__PURE__*/function(t){function r(r){return t.call(this,r,"[InvoiceNotFoundError]: Facture introuvable")||this}return i(r,t),r}(l),g=/*#__PURE__*/function(t){function r(r){return t.call(this,r,"[InvalidAmountError]: Montant invalide. Il doit être compris entre 20 et 1 000 000.")||this}return i(r,t),r}(l),k=/*#__PURE__*/function(t){function r(r){return t.call(this,r,"[MerchantAccountDoesNotExistError]: Aucun compte marchand sur le réseau spécifié")||this}return i(r,t),r}(l),E=/*#__PURE__*/function(t){function r(r){return t.call(this,r,"[NoPendProcPayout24HError]: Aucun paiement en attente ou traité au cours des dernières 24 heures")||this}return i(r,t),r}(l),w=/*#__PURE__*/function(t){function r(r){return t.call(this,r,"[NoDeposit3MError]: Aucun paiement en attente ou traité au cours des 3 derniers mois")||this}return i(r,t),r}(l),O=/*#__PURE__*/function(t){function r(r){return t.call(this,r,"Le montant demandé est en dehors de l'intervalle [20;1000000].")||this}return i(r,t),r}(l),j=/*#__PURE__*/function(t){function r(r){return t.call(this,r,"[IpDeniedError]: Adresse IP refusée.")||this}return i(r,t),r}(l),T=/*#__PURE__*/function(t){function r(r){return t.call(this,r,"[ProcessingError]: Une erreur s'est produite pendant le traitement.")||this}return i(r,t),r}(l),A=/*#__PURE__*/function(t){function r(r){return t.call(this,r,"[SendingError]: Une erreur s'est produite pendant l'envoi.")||this}return i(r,t),r}(l),U=/*#__PURE__*/function(t){function r(r){return t.call(this,r,"[DataInputError]: Données incorrectes.")||this}return i(r,t),r}(l),I=/*#__PURE__*/function(t){function r(r){return t.call(this,r,"[ApiError]: Erreur d'API.")||this}return i(r,t),r}(l),x=/*#__PURE__*/function(t){function r(r){return t.call(this,r,"[NoHashError]: Aucun hash fourni.")||this}return i(r,t),r}(l),q=/*#__PURE__*/function(t){function r(r){return t.call(this,r,"[InvalidHashError]: Hash invalide.")||this}return i(r,t),r}(l),K=/*#__PURE__*/function(t){function r(r){return t.call(this,r,"[NoNetworkAccessConfigurationError]: Aucun accès réseau configuré.")||this}return i(r,t),r}(l),M=/*#__PURE__*/function(t){function r(r){return t.call(this,r,"[UnauthorizedMethodError]: Methode non autorisée.")||this}return i(r,t),r}(l),D={payin:{test:{"00":h,"01":f,"02":g,"03":j,"04":T},live:{"00":h,"01":v,"02":g,"03":j,"04":T,"05":A,"06":A,"07":K,"08":U,"09":I,10:x,11:q,12:/*#__PURE__*/function(t){function r(r){return t.call(this,r,"[InvalidMethodError]: Methode invalide.")||this}return i(r,t),r}(l),13:M}},client_payout:{test:{"00":h,"01":m,"02":y,"03":k,"03a":E,"03b":w,"04":d,"05":O,"06":j,"07":_,"08":T,"09":U,10:I,13:x,14:q},live:{"00":h,"01":m,"02":y,"03":k,"03a":E,"03b":w,"04":d,"05":O,"06":j,"07":_,"08":T,"09":U,10:I,13:x,14:q}},merchant_payout:{test:{"00":h,"01":f,"02":O,"03":k,"04":E,"05":p,"06":k,"07":k,"08":d,"09":T,10:I,11:x,12:q,13:b,14:j},live:{"00":h,"01":f,"02":O,"03":k,"04":E,"05":p,"06":k,"07":k,"08":d,"09":T,10:I,11:x,12:q,13:b,14:j}},status:{test:{"00":h,"01":f,"02":P,"03":T},live:{"00":h,"01":v,"02":P,"03":T,"04":U}}},R=/*#__PURE__*/function(t){function r(){return t.apply(this,arguments)||this}i(r,t);var e=r.prototype;return e.getDataOrRaiseError=function(t,r){try{var e=t,n=t.response_text;if("00"==t.response_code){var i=t.custom_data;if(i&&i.length>0){var o=i.reduce(function(t,r){return t[r.keyof_customdata]=r.valueof_customdata,t},{});e.custom_data=o}return Promise.resolve(e)}var u=n.match(/\d{2,3}[a-z]?/i),a=u?u[0]:"",c=function(t,r,e){var n,i;return(null==D||null==(n=D[r])||null==(i=n[t])?void 0:i[e])||I}(this.platform,r,a);throw new c(a)}catch(t){return Promise.reject(t)}},e.get=function(t,r){try{var e=this;return Promise.resolve(e.request(t)).then(function(t){return Promise.resolve(e.getDataOrRaiseError(t,r))})}catch(t){return Promise.reject(t)}},e.post=function(t,r,e){try{var n=this;return Promise.resolve(n.request(t,{method:"POST",body:JSON.stringify(r)})).then(function(t){return Promise.resolve(n.getDataOrRaiseError(t,e))})}catch(t){return Promise.reject(t)}},r}(/*#__PURE__*/function(){function r(t){this.apiKey=void 0,this.authToken=void 0,this.baseUrl=void 0,this.platform=void 0,this.apiKey=t.apiKey,this.authToken=t.authToken,this.platform=t.platform||"test",this.baseUrl=t.baseUrl||s[t.platform]}var e=r.prototype;return e.buildUrl=function(t){return this.baseUrl+t},e.request=function(r,e){try{var i=this,o=i.buildUrl(r),u=n({},e,{headers:{Apikey:i.apiKey,Authorization:"Bearer "+i.authToken,Accept:"application/json","Content-Type":"application/json"}});return Promise.resolve(t(o,u)).then(function(t){if(t.ok)return t.json();throw new Error(t.statusText)})}catch(t){return Promise.reject(t)}},r}()),N=/*#__PURE__*/function(){function t(t){this.name=void 0,this.description="",this._unit_price=void 0,this._quantity=void 0,this._total_price=void 0,this.name=t.name,this.description=(null==t?void 0:t.description)||"",this.quantity=t.quantity,this.unit_price=t.unit_price,this._total_price=t.unit_price*t.quantity}return t.prototype.format=function(){return{name:this.name,description:this.description,quantity:this.quantity,unit_price:this.unit_price,total_price:this.total_price}},e(t,[{key:"quantity",get:function(){return this._quantity},set:function(t){this._quantity=t,this._total_price=this.unit_price*t}},{key:"unit_price",get:function(){return this._unit_price},set:function(t){this._unit_price=t,this._total_price=this._quantity*t}},{key:"total_price",get:function(){return this._total_price}}]),t}(),S=/*#__PURE__*/function(t){function r(r,e){var n;return(n=t.call(this,r)||this)._items=void 0,n.currency="xof",n.description="",n.customer_firstname="",n.customer_lastname="",n.customer_email="",n.store_name="",n.store_website_url="",n.external_id="",n.otp="",n._total_amount=0,n.currency=(null==e?void 0:e.currency)||"XOF",n.description=(null==e?void 0:e.description)||"",n.customer_firstname=(null==e?void 0:e.customer_firstname)||"",n.customer_lastname=(null==e?void 0:e.customer_lastname)||"",n.customer_email=(null==e?void 0:e.customer_email)||"",n.store_name=(null==e?void 0:e.store_name)||"",n.store_website_url=(null==e?void 0:e.store_website_url)||"",n._items=[],n}i(r,t);var n=r.prototype;return n.setItemsTotalAmount=function(){this._total_amount=this._items.reduce(function(t,r){return t+r.total_price},0)},n.addItem=function(t){this._items.push(new N(t)),this.setItemsTotalAmount()},n.formatInvoice=function(t){return void 0===t&&(t=""),{items:this._items.map(function(t){return t.format()}),total_amount:this._total_amount,devise:this.currency,description:this.description,customer:t||"",customer_firstname:this.customer_firstname,customer_lastname:this.customer_lastname,customer_email:this.customer_email,external_id:this.external_id,otp:this.otp}},n.formatPayload=function(t,r,e,n,i){void 0===t&&(t=""),void 0===r&&(r=null),void 0===e&&(e=null),void 0===n&&(n=""),void 0===i&&(i={});var o={callback_url:n};return r&&(o.cancel_url=r),e&&(o.return_url=e),{commande:{invoice:this.formatInvoice(t),store:{name:this.store_name,website_url:this.store_website_url},actions:o,custom_data:i}}},n.payWithRedirection=function(t){var r=t.cancel_url,e=void 0===r?"":r,n=t.return_url,i=void 0===n?"":n,o=t.callback_url,u=void 0===o?"":o,a=t.custom_data,c=void 0===a?{}:a;try{var s=this.formatPayload(null,e,i,u,c);return Promise.resolve(this.post("redirect/checkout-invoice/create",s,"payin"))}catch(t){return Promise.reject(t)}},n.payWithoutRedirection=function(t){var r=t.otp,e=void 0===r?"":r,n=t.customer,i=void 0===n?"":n,o=t.callback_url,u=void 0===o?"":o,a=t.custom_data,c=void 0===a?{}:a;try{var s=this;s.otp=e;var l=s.formatPayload(i,u,null,null,c);return Promise.resolve(s.post("straight/checkout-invoice/create",l,"payin"))}catch(t){return Promise.reject(t)}},e(r,[{key:"items",get:function(){return this._items}},{key:"total_amount",get:function(){return this._total_amount}}]),r}(R),C=/*#__PURE__*/function(t){function r(r,e,n,i){var o;return(o=t.call(this,r)||this).amount=0,o.description="",o.customer="",o.amount=e,o.description=n,o.customer=i,o}return i(r,t),r.prototype.send=function(t){try{var r=this,e={amount:r.amount,description:r.description,customer:r.customer,custom_data:t.custom_data||{},callback_url:t.callback_url||""};return"client"===t.type&&(e.to_ligdicash=t.to_wallet||!1),Promise.resolve(r.post("client"===t.type?"withdrawal/create":"straight/payout",{commande:e},"client"===t.type?"client_payout":"merchant_payout"))}catch(t){return Promise.reject(t)}},r}(R),F=/*#__PURE__*/function(){function t(t){this.apiKey=void 0,this.authToken=void 0,this.baseUrl=void 0,this.platform=void 0,this.apiKey=t.apiKey,this.authToken=t.authToken,this.platform=t.platform||"test",this.baseUrl=t.baseUrl}var r=t.prototype;return r.Withdrawal=function(t,r,e){return new C({apiKey:this.apiKey,authToken:this.authToken,platform:this.platform,baseUrl:this.baseUrl},t,r,e)},r.Invoice=function(t){return new S({apiKey:this.apiKey,authToken:this.authToken,platform:this.platform,baseUrl:this.baseUrl},t)},r.getTransaction=function(t,r){return void 0===r&&(r="payin"),function(t,r,e){void 0===e&&(e="payin");try{var n=new R(t);return Promise.resolve(n.get("payin"===e?"redirect/checkout-invoice/confirm/?invoiceToken="+r:"client_payout"===e?"withdrawal/confirm/?withdrawalToken="+r:"straight/payout/confirm/?payoutToken="+r,"status"))}catch(t){return Promise.reject(t)}}({apiKey:this.apiKey,authToken:this.authToken,platform:this.platform,baseUrl:this.baseUrl},t,r)},t}();export{F as default};
//# sourceMappingURL=index.m.js.map
